<!doctype html><html>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title> Python和Excel的不解之缘 &#183; 随笔 </title>
<link rel=stylesheet href=http://yuguo.im/css/slim.css>
<link rel=stylesheet href=http://yuguo.im/css/highlight.min.css>
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro" rel=stylesheet type=text/css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=/favicon.ico>
<link href rel=alternate type=application/rss+xml title=随笔>
</head>
<body>
<div class=container>
<div class=header>
<h1 class=site-title><a href=http://yuguo.im/>随笔</a></h1>
<p class=site-tagline>Stay hungry. Stay foolish.</p>
<div class=nav>
<a class=nav-btn href=#>
<span class="ci ci-burger"></span>
</a>
<ul class=nav-list>
<li class=spacer>&ac;</li>
<li><a href=https://github.com/xiayuguo>Github</a></li>
</ul>
</div>
</div>
<div class=content>
<div class=posts>
<div class=post>
<h2 class=post-title><a href=http://yuguo.im/post/2017/python-excel/>Python和Excel的不解之缘</a></h2>
<span class=post-date>Apr 10, 2017 </span>
<div class=post-content>
<h2 id=表格处理模块>表格处理模块</h2>
<ul>
<li><a href=http://xlwt.readthedocs.io/en/latest/>xlwt (writing xls files)</a></li>
<li><a href=http://xlrd.readthedocs.io/en/latest/>xlrd (reading xls/xlsx files)</a></li>
<li><a href=https://openpyxl.readthedocs.io/en/default/>openpyxl (reading/writing xlsx files)</a></li>
<li><a href=https://xlsxwriter.readthedocs.io>xlsxwriter (writing xlsx files)</a></li>
<li><a href=http://www.python-excel.org/>more details</a></li>
</ul>
<h2 id=xlwt>xlwt</h2>
<p>直接上干货, 重点看export_excel函数</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># -*- coding: utf-8 -*-</span>

<span style=color:#f92672>import</span> xlwt
<span style=color:#f92672>import</span> functools

<span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cost_time</span>(method):
    <span style=color:#a6e22e>@functools</span><span style=color:#f92672>.</span>wraps(method)
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
        start_time <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now()
        num <span style=color:#f92672>=</span> method(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
        end_time <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now()
        print(<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;导出</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>条数据, 共消耗</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>时间&#34;</span> <span style=color:#f92672>%</span> (num, str(end_time <span style=color:#f92672>-</span> start_time)))
    <span style=color:#66d9ef>return</span> wrapper


<span style=color:#a6e22e>@cost_time</span>
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>export_excel</span>(filename, header, content, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
    wb <span style=color:#f92672>=</span> xlwt<span style=color:#f92672>.</span>Workbook()
    <span style=color:#66d9ef>if</span> len(content) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>65536</span>:
        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;你的数据量为</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, 超过65536, 拒绝通过xlwt导出&#34;</span> <span style=color:#f92672>%</span> len(content))
    ws <span style=color:#f92672>=</span> wb<span style=color:#f92672>.</span>add_sheet(<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;报表&#34;</span>)
    ws1 <span style=color:#f92672>=</span> wb<span style=color:#f92672>.</span>add_sheet(<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;表2&#34;</span>)

    <span style=color:#75715e># 写表头</span>
    map(<span style=color:#66d9ef>lambda</span> h: ws<span style=color:#f92672>.</span>write(<span style=color:#ae81ff>0</span>, h[<span style=color:#ae81ff>0</span>], h[<span style=color:#ae81ff>1</span>]), enumerate(header))

    <span style=color:#75715e># 写主体内容</span>
    map(<span style=color:#66d9ef>lambda</span> c: map(<span style=color:#66d9ef>lambda</span> sub_c: ws<span style=color:#f92672>.</span>write(c[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, sub_c[<span style=color:#ae81ff>0</span>], sub_c[<span style=color:#ae81ff>1</span>]), enumerate(c[<span style=color:#ae81ff>1</span>])), enumerate(content))

    ws1<span style=color:#f92672>.</span>write(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;test&#34;</span>)

    wb<span style=color:#f92672>.</span>save(filename)
    <span style=color:#66d9ef>return</span> len(content)


<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
    header <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#e6db74>&#34;C&#34;</span>, <span style=color:#e6db74>&#34;D&#34;</span>, <span style=color:#e6db74>&#34;E&#34;</span>, <span style=color:#e6db74>&#34;F&#34;</span>, <span style=color:#e6db74>&#34;G&#34;</span>)
    a <span style=color:#f92672>=</span> xrange(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>77777</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1</span>)
    content <span style=color:#f92672>=</span> [(a[i], a[i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>], a[i<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>], a[i<span style=color:#f92672>+</span><span style=color:#ae81ff>3</span>], a[i<span style=color:#f92672>+</span><span style=color:#ae81ff>4</span>], a[i<span style=color:#f92672>+</span><span style=color:#ae81ff>5</span>], a[i<span style=color:#f92672>+</span><span style=color:#ae81ff>6</span>]) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(a))[::<span style=color:#ae81ff>7</span>]]
    export_excel(<span style=color:#e6db74>&#34;test.xls&#34;</span>, header<span style=color:#f92672>=</span>header, content<span style=color:#f92672>=</span>content)

</code></pre></div><h2 id=xlrd>xlrd</h2>
<p>后续更新, 敬请期待&mldr;</p>
<h2 id=openpyxl>openpyxl</h2>
<p>后续更新, 敬请期待&mldr;</p>
<h2 id=xlsxwriter>xlsxwriter</h2>
<p>后续更新, 敬请期待&mldr;</p>
</div>
</div>
<div class=pagination>
<a class="btn previous" href=http://yuguo.im/post/2017/mysql/> Prev</a>
<a class="btn next" href=http://yuguo.im/post/2017/oauth2/> Next</a>
</div>
</div>
</div>
<div class=footer>
<p>Copyright@<a href=http://yuguo.im/about>Yuguo</a> 2019. Powered by <a href=https://gohugo.io/>Hugo</a>. This theme—Slim—is open sourced on <a href=https://github.com/zhe/hugo-theme-slim>Github</a>.</p>
</div>
</div>
<script src=http://yuguo.im/js/slim.js></script>
<script src=http://yuguo.im/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-161689466-1','auto'),ga('send','pageview')</script>
</body>
</html>