<!doctype html><html>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title> MySQL的limit用法和分页查询的性能优化 &#183; 随笔 </title>
<link rel=stylesheet href=https://yuguo.im/css/slim.css>
<link rel=stylesheet href=https://yuguo.im/css/highlight.min.css>
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro" rel=stylesheet type=text/css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=/favicon.ico>
<link href rel=alternate type=application/rss+xml title=随笔>
</head>
<body>
<div class=container>
<div class=header>
<h1 class=site-title><a href=https://yuguo.im/>随笔</a></h1>
<p class=site-tagline>Stay hungry. Stay foolish.</p>
<div class=nav>
<a class=nav-btn href=#>
<span class="ci ci-burger"></span>
</a>
<ul class=nav-list>
<li class=spacer>&ac;</li>
<li><a href=https://github.com/xiayuguo>Github</a></li>
</ul>
</div>
</div>
<div class=content>
<div class=posts>
<div class=post>
<h2 class=post-title><a href=https://yuguo.im/post/2017/mysql-limit/>MySQL的limit用法和分页查询的性能优化</a></h2>
<span class=post-date>Apr 27, 2017 </span>
<div class=post-content>
<blockquote>
<p>学习任何东西都可以按照3W的框架进行，容器技术也是一样，先回答 What、Why 和 How 这三个问题。</p>
</blockquote>
<p>CloudMan-<a href=http://www.cnblogs.com/CloudMan6/p/6751516.html>每天5分钟玩转容器技术（6）</a></p>
<blockquote>
<p>我非常赞同CloudMan的观点, 下面咱就以这三个问题来讨论今天的主题</p>
</blockquote>
<h1 id=what-mysql中的limit是干啥的>What-Mysql中的LIMIT是干啥的?</h1>
<p>在我们使用查询语句的时候，经常要返回前几条或者中间某几行数据，这个时候怎么办呢？不用担心，mysql已经为我们提供了这样一个功能。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>LIMIT</span> [<span style=color:#66d9ef>offset</span>,] <span style=color:#66d9ef>rows</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>OFFSET</span> <span style=color:#66d9ef>offset</span>
</code></pre></div><p>LIMIT 子句可以被用于强制 SELECT 语句返回指定的记录数。LIMIT 接受一个或两个数字参数。如果给定一个参数(rows), 偏移量offset默认为0, 指定返回[:rows]的数据; 如果给定两个参数(offset, rows)，offset指定第一个返回记录行的偏移量，rows指定返回记录行的最大数目。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mysql&gt; SELECT * FROM table LIMIT 5,10; // 检索记录行 6-15 
</code></pre></div><p>获得开头的几行数据</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mysql&gt; SELECT * FROM table LIMIT 10; // 检索记录行 0-9
</code></pre></div><p>获得结尾的几行数据</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mysql&gt; SELECT * FROM table LIMIT 100,-1; // 检索记录行 100-last.
</code></pre></div><h1 id=why-为什么需要为分页查询做优化>Why-为什么需要为分页查询做优化?</h1>
<ul>
<li>随着数据量的增加，页数会越来越多，查看后几页的SQL就可能类似下面示例。总而言之，越往后分页，LIMIT语句的偏移量(offset)就会越大，速度也会明显变</li>
<li>随着业务的复杂度越来越高, 查询条件不断增多, 可想而知, 速度也会越来越慢</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> age <span style=color:#f92672>=</span> <span style=color:#ae81ff>12</span> <span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> id <span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>10000</span>, <span style=color:#ae81ff>20</span>
</code></pre></div><h1 id=how-分页查询如何优化>How-分页查询如何优化?</h1>
<ul>
<li>
<p>提速原理:
避免全表扫描,而是通过索引找到指定位置,于是就相当于只是扫描了指定数量(rows)的数据</p>
</li>
<li>
<p>实现方式:</p>
<ul>
<li>子查询分页方式</li>
</ul>
<pre tabindex=0><code>SELECT * FROM users WHERE  id &gt;=  
(SELECT id FROM users  WHERE age = 12 ORDER BY id LIMIT 10000, 1) LIMIT 20
</code></pre><ul>
<li>JOIN分页方式</li>
</ul>
<pre tabindex=0><code>暂缺示例
</code></pre></li>
</ul>
</div>
</div>
<div class=pagination>
<a class="btn previous" href=https://yuguo.im/post/2017/python-config/> Prev</a>
<a class="btn next" href=https://yuguo.im/post/2017/high-speed-seat/> Next</a>
</div>
</div>
</div>
<div class=footer>
<p>Copyright@<a href=https://xiayuguo.github.io/about>Yuguo</a> 2019. Powered by <a href=https://gohugo.io/>Hugo</a>. This theme—Slim—is open sourced on <a href=https://github.com/zhe/hugo-theme-slim>Github</a>.</p>
</div>
</div>
<script src=https://yuguo.im/js/slim.js></script>
<script src=https://yuguo.im/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-161689466-1','auto'),ga('send','pageview')</script>
</body>
</html>